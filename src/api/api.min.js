module.exports=function(e){var t={};function o(r){if(t[r])return t[r].exports;var c=t[r]={i:r,l:!1,exports:{}};return e[r].call(c.exports,c,c.exports,o),c.l=!0,c.exports}return o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var c in e)o.d(r,c,function(t){return e[t]}.bind(null,c));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=2)}([function(e,t){e.exports=require("firebase")},function(e,t){e.exports=require("react")},function(e,t,o){e.exports=o(3)},function(e,t,o){"use strict";o.r(t);var r={};o.r(r),o.d(r,"deleteResource",(function(){return P})),o.d(r,"deleteSubCollectionDoc",(function(){return v})),o.d(r,"storageUploadImages",(function(){return R})),o.d(r,"updateAdImages",(function(){return U})),o.d(r,"deleteAdImage",(function(){return k})),o.d(r,"updateResource",(function(){return j})),o.d(r,"createResource",(function(){return S})),o.d(r,"createSubCollection",(function(){return O})),o.d(r,"fetchSubCollection",(function(){return x})),o.d(r,"updateSubCollection",(function(){return A})),o.d(r,"update",(function(){return E})),o.d(r,"fetchResource",(function(){return I})),o.d(r,"fetchResources",(function(){return C}));var c={};o.r(c),o.d(c,"fetchUsers",(function(){return N})),o.d(c,"fetchUserProfile",(function(){return T})),o.d(c,"createUserProfile",(function(){return $})),o.d(c,"updateUserProfile",(function(){return B})),o.d(c,"updateProfilePicture",(function(){return L})),o.d(c,"addUserPermission",(function(){return M})),o.d(c,"fetchUserPermissions",(function(){return z})),o.d(c,"deleteUser",(function(){return q})),o.d(c,"logout",(function(){return V}));var n={};o.r(n),o.d(n,"sendEmail",(function(){return Y}));var s=o(0),a=o.n(s);const i={apiKey:"AIzaSyArviWe21r_1PtcSFb8unFdXYY_XLRNZNU",authDomain:"code-school-ssr.firebaseapp.com",databaseURL:"https://code-school-ssr.firebaseio.com",projectId:"code-school-ssr",storageBucket:"code-school-ssr.appspot.com",messagingSenderId:"309373477600",appId:"1:309373477600:web:2734579c5232e0d8fca685"};var l=o(1),u=o.n(l);const d="undefined"==typeof window,f={beginner:"Beginner",intermediate:"Intermediate",advanced:"Advanced"},h=(Object.keys(f).map(e=>u.a.createElement("option",{key:e,value:e},f[e])),{frontend:"Frontend developer",backend:"Backend developer",designer:"Designer"});Object.keys(h).map(e=>u.a.createElement("option",{key:e,value:e},h[e]));let p={};if(!d){a.a.initializeApp(i);const e=a.a.database(),t=a.a.storage().ref(),o=a.a.firestore(),r=a.a.auth();p={db:e,storage:t,firestore:o,firebase:a.a,auth:r}}var g={db:()=>{},storage:()=>{},firestore:()=>{},firebase:()=>{},...p};const{storage:m,firestore:y,auth:w,firebase:b}=g;d||(window.fetchResources=C,window.fetchResource=I);const P=async(e,t)=>{try{await y.collection(e).doc(t).delete(),console.log("---- delete Resource success: ")}catch(e){console.log("---- delete Resource error: ",e)}},v=async(e,t,o,r)=>{try{await y.collection(e).doc(t).collection(o).doc(r).delete(),console.log("---- delete subCollection doc success: ")}catch(e){throw e}},R=(e,t)=>{const o=w.currentUser.uid;if(!t.length)return Promise.resolve([]);const r=[],c=Object.keys(t).map(c=>{const n=t[c];return new Promise((t,c)=>{((t,c,n)=>{const s=(new Date).getTime(),a=m.child(`images/${e}/${o}/${s}`);a.put(t).then(()=>{a.getDownloadURL().then(e=>{r.push(e),c()})},e=>n(e))})(n,t,c)})});return Promise.all(c).then(()=>r).catch(e=>console.error(e))},U=async({adId:e,images:t})=>{const o=await R(e,t);try{const t=y.collection("ads").doc(e);return await t.update({images:b.firestore.FieldValue.arrayUnion(...o)}),Promise.resolve("ok")}catch(e){console.log("updateAdImages error: ",e)}},k=async({adId:e,imgUrl:t})=>{try{await(async e=>{if(!e)return;const t="images"+e.split("?")[0].split("images")[1].replace(/%2F/g,"/");try{const e=m.child(t);return await e.delete(),Promise.Resolve("delete success")}catch(e){return Promise.resolve("image delete error: ",e)}})(t);const o=y.collection("ads").doc(e);return await o.update({images:b.firestore.FieldValue.arrayRemove(t)}),Promise.resolve("ok")}catch(e){console.log("delete image error: ",e)}},j=async(e,t,o)=>{try{const r=y.collection(e).doc(t);return await r.update(o),Promise.resolve("ok")}catch(e){console.error("updateAd error: ",e)}},S=async(e,t)=>{if(Object.keys(t).length)try{const o=y.collection(e).doc(),r=o.id,c=t.images;return c&&c.length?(delete t.images,t.images=await R(r,c),await o.set(t)):await o.set(t),console.log("-----create resource success: ",r),r}catch(e){console.error("create Resource error",e)}},O=async(e,t,o,r)=>{if(Object.keys(r).length)try{const c=y.collection(e).doc(t).collection(o).doc(),n=c.id,s=r.images;return s&&s.length?(delete r.images,r.images=await R(n,s),await c.set(r)):await c.set(r),console.log("-----create resource success: ",n),n}catch(e){console.error("create Resource error",e)}},x=async(e,t,o)=>{const r={};try{const c=y.collection(e).doc(t).collection(o);return(await c.get()).forEach(e=>{r[e.id]=e.data()}),console.log("fetch subCollection success"),r}catch(e){console.error("fetch subCollection error",e)}},A=async(e,t,o,r,c)=>{try{const n=y.collection(e).doc(t).collection(o).doc(r);return await n.update(c),Promise.resolve("ok")}catch(e){throw e}},E=async(e,t)=>{try{let o=y;return e.split("/").forEach((e,t)=>o=o.collection(e)),await o.update(t),Promise.resolve("ok")}catch(e){throw e}},I=async e=>{try{let t=y;e.split("/").forEach((e,o)=>t=(o+1)%2!=0?t.collection(e):t.doc(e));const o=await t.get();if(o.exists)return console.log("----data: ",o.data()),o.data();console.log("No such document!")}catch(e){throw e}},C=async(e,t={})=>{const o={};try{let r=y;e.split("/").forEach((e,t)=>r=(t+1)%2!=0?r.collection(e):r.doc(e)),Object.keys(t).forEach(e=>{const[o,c]=t[e];r=r.where(e,o,c)});return(await r.get()).forEach(e=>{o[e.id]=e.data()}),console.log("--fetched Resources: ",o),o}catch(e){console.log("---- fetch Resources error: ",e)}};d||(window.fetchResources=C,window.fetchResource=I,window.updateResource=j,window.createResource=S,window.deleteResource=P,window.createSubCollection=O,window.deleteSubCollectionDoc=v,window.updateSubCollection=A);const{firestore:_,auth:D,storage:F}=g,N=async()=>{const e={};try{(await _.collection("users").get()).forEach(t=>{e[t.id]=t.data()})}catch(e){console.log("---- fetch Ads error: ",e)}return console.log("--fetched Ads: ",e),e};async function T(e){let t=_.collection("users").doc(e);try{const e=await t.get();return!!e.exists&&e.data()}catch(e){console.log("---- fetchUserPreferences error: ",e)}}async function $(e){let t=_.collection("users").doc(e.uid);try{await t.set(e)}catch(e){console.log("---- fetchUserPreferences error: ",e)}}async function B(e){let t=_.collection("users").doc(e.uid);try{return await t.update(e)}catch(e){console.log("---- fetchUserPreferences error: ",e)}}const L=async(e,t)=>{if(!e||!t)return;const o=_.collection("users").doc(e);let r=null;return new Promise((o,c)=>{((t,o,c)=>{F.child(`images/${e}/profilePicture`).put(t).then(e=>{e.ref.getDownloadURL().then(e=>{r=e,o()})},e=>c(e))})(t,o,c)}).then(()=>o.update({profileImage:r})).catch(e=>(console.error(e),e))},M=async({uid:e,permission:t})=>{try{const o=_.collection("permissions").doc(e);(await o.get()).exists?o.update(t):o.set(t)}catch(e){throw e.toString()}};async function z(e){let t=_.collection("permissions").doc(e);try{const o=await t.get();return!!o.exists&&{uid:e,data:o.data()}}catch(e){console.log("---- fetchUserPreferences error: ",e)}}const q=async e=>{try{return await _.collection("users").doc(e).delete(),Promise.resolve("ok")}catch(e){return Promise.reject("error: "+e)}},V=()=>D.signOut(),X=g.auth;function Y(e){((e,t,o)=>{new Promise((r,c)=>{X.currentUser.getToken().then(c=>{const n=new Headers;n.append("Authorization","Bearer "+c),n.append("Content-Type","application/json"),fetch("https://us-central1-lawbook-e9997.cloudfunctions.net/expressApp/sendEmail",{method:"POST",mode:"cors",headers:n,body:JSON.stringify({addressees:e,text:t,subject:o})}).then(e=>{r(e),console.log("sendEmail response: ",e)})})})})(["justinas.simutis@gmail.com"],`New user with the following email: ${e}, has registered on the property rent website.`,"New user registration")}t.default={resource:r,user:c,email:n,firebase:g.firebase}}]);
