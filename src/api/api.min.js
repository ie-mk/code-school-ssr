module.exports=function(e){var t={};function r(o){if(t[o])return t[o].exports;var c=t[o]={i:o,l:!1,exports:{}};return e[o].call(c.exports,c,c.exports,r),c.l=!0,c.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var c in e)r.d(o,c,function(t){return e[t]}.bind(null,c));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t){e.exports=require("firebase")},function(e,t,r){e.exports=r(2)},function(e,t,r){"use strict";r.r(t);var o={};r.r(o),r.d(o,"fetchResources",(function(){return m})),r.d(o,"fetchResource",(function(){return y})),r.d(o,"deleteResource",(function(){return w})),r.d(o,"storageUploadImages",(function(){return b})),r.d(o,"updateAdImages",(function(){return P})),r.d(o,"deleteAdImage",(function(){return R})),r.d(o,"updateResource",(function(){return v})),r.d(o,"createResource",(function(){return U})),r.d(o,"createSubCollection",(function(){return j}));var c={};r.r(c),r.d(c,"fetchUsers",(function(){return k})),r.d(c,"fetchUserProfile",(function(){return A})),r.d(c,"createUserProfile",(function(){return I})),r.d(c,"updateUserProfile",(function(){return _})),r.d(c,"updateProfilePicture",(function(){return E})),r.d(c,"addUserPermission",(function(){return N})),r.d(c,"fetchUserPermissions",(function(){return T})),r.d(c,"deleteUser",(function(){return F})),r.d(c,"logout",(function(){return $}));var n={};r.r(n),r.d(n,"sendEmail",(function(){return L}));var s=r(0),a=r.n(s);const i={apiKey:"AIzaSyArviWe21r_1PtcSFb8unFdXYY_XLRNZNU",authDomain:"code-school-ssr.firebaseapp.com",databaseURL:"https://code-school-ssr.firebaseio.com",projectId:"code-school-ssr",storageBucket:"code-school-ssr.appspot.com",messagingSenderId:"309373477600",appId:"1:309373477600:web:2734579c5232e0d8fca685"},u="undefined"==typeof window;let l={};if(!u){a.a.initializeApp(i);const e=a.a.database(),t=a.a.storage().ref(),r=a.a.firestore(),o=a.a.auth();l={db:e,storage:t,firestore:r,firebase:a.a,auth:o}}var d={db:()=>{},storage:()=>{},firestore:()=>{},firebase:()=>{},...l};const{storage:f,firestore:h,auth:g,firebase:p}=d,m=async(e,t={})=>{const r={};try{let o;o=h.collection(e),Object.keys(t).forEach(e=>{const[r,c]=t[e];o=o.where(e,r,c)});(await o.get()).forEach(e=>{r[e.id]=e.data()})}catch(e){console.log("---- fetch Resources error: ",e)}return console.log("--fetched Resources: ",r),r},y=async(e,t)=>{try{const r=h.collection(e).doc(t),o=await r.get();if(o.exists)return console.log("----data: ",o.data()),o.data();console.log("No such document!")}catch(e){console.log("---- fetch Resource error: ",e)}};u||(window.fetchResources=m,window.fetchResource=y);const w=async(e,t)=>{try{await h.collection(e).doc(t).delete(),console.log("---- delete Resource success: ")}catch(e){console.log("---- delete Resource error: ",e)}},b=(e,t)=>{const r=g.currentUser.uid;if(!t.length)return Promise.resolve([]);const o=[],c=Object.keys(t).map(c=>{const n=t[c];return new Promise((t,c)=>{((t,c,n)=>{const s=(new Date).getTime(),a=f.child(`images/${e}/${r}/${s}`);a.put(t).then(()=>{a.getDownloadURL().then(e=>{o.push(e),c()})},e=>n(e))})(n,t,c)})});return Promise.all(c).then(()=>o).catch(e=>console.error(e))},P=async({adId:e,images:t})=>{const r=await b(e,t);try{const t=h.collection("ads").doc(e);return await t.update({images:p.firestore.FieldValue.arrayUnion(...r)}),Promise.resolve("ok")}catch(e){console.log("updateAdImages error: ",e)}},R=async({adId:e,imgUrl:t})=>{try{await(async e=>{if(!e)return;const t="images"+e.split("?")[0].split("images")[1].replace(/%2F/g,"/");try{const e=f.child(t);return await e.delete(),Promise.Resolve("delete success")}catch(e){return Promise.resolve("image delete error: ",e)}})(t);const r=h.collection("ads").doc(e);return await r.update({images:p.firestore.FieldValue.arrayRemove(t)}),Promise.resolve("ok")}catch(e){console.log("delete image error: ",e)}},v=async(e,t,r)=>{try{const o=h.collection(e).doc(t);return await o.update(r),Promise.resolve("ok")}catch(e){console.error("updateAd error: ",e)}},U=async(e,t)=>{if(Object.keys(t).length)try{const r=h.collection(e).doc(),o=r.id,c=t.images;return c&&c.length?(delete t.images,t.images=await b(o,c),await r.set(t)):await r.set(t),console.log("-----create resource success: ",o),o}catch(e){console.error("create Resource error",e)}},j=async(e,t,r,o)=>{if(Object.keys(o).length)try{const c=h.collection(e).doc(t).collection(r).doc(),n=c.id,s=o.images;return s&&s.length?(delete o.images,o.images=await b(n,s),await c.set(o)):await c.set(o),console.log("-----create resource success: ",n),n}catch(e){console.error("create Resource error",e)}};u||(window.fetchResources=m,window.fetchResource=y,window.updateResource=v,window.createResource=U,window.deleteResource=w,window.createSubCollection=j);const{firestore:x,auth:O,storage:S}=d,k=async()=>{const e={};try{(await x.collection("users").get()).forEach(t=>{e[t.id]=t.data()})}catch(e){console.log("---- fetch Ads error: ",e)}return console.log("--fetched Ads: ",e),e};async function A(e){let t=x.collection("users").doc(e);try{const e=await t.get();return!!e.exists&&e.data()}catch(e){console.log("---- fetchUserPreferences error: ",e)}}async function I(e){let t=x.collection("users").doc(e.uid);try{await t.set(e)}catch(e){console.log("---- fetchUserPreferences error: ",e)}}async function _(e){let t=x.collection("users").doc(e.uid);try{return await t.update(e)}catch(e){console.log("---- fetchUserPreferences error: ",e)}}const E=async(e,t)=>{if(!e||!t)return;const r=x.collection("users").doc(e);let o=null;return new Promise((r,c)=>{((t,r,c)=>{S.child(`images/${e}/profilePicture`).put(t).then(e=>{e.ref.getDownloadURL().then(e=>{o=e,r()})},e=>c(e))})(t,r,c)}).then(()=>r.update({profileImage:o})).catch(e=>(console.error(e),e))},N=async({uid:e,permission:t})=>{try{const r=x.collection("permissions").doc(e);(await r.get()).exists?r.update(t):r.set(t)}catch(e){throw e.toString()}};async function T(e){let t=x.collection("permissions").doc(e);try{const r=await t.get();return!!r.exists&&{uid:e,data:r.data()}}catch(e){console.log("---- fetchUserPreferences error: ",e)}}const F=async e=>{try{return await x.collection("users").doc(e).delete(),Promise.resolve("ok")}catch(e){return Promise.reject("error: "+e)}},$=()=>O.signOut(),D=d.auth;function L(e){((e,t,r)=>{new Promise((o,c)=>{D.currentUser.getToken().then(c=>{const n=new Headers;n.append("Authorization","Bearer "+c),n.append("Content-Type","application/json"),fetch("https://us-central1-lawbook-e9997.cloudfunctions.net/expressApp/sendEmail",{method:"POST",mode:"cors",headers:n,body:JSON.stringify({addressees:e,text:t,subject:r})}).then(e=>{o(e),console.log("sendEmail response: ",e)})})})})(["justinas.simutis@gmail.com"],`New user with the following email: ${e}, has registered on the property rent website.`,"New user registration")}t.default={resource:o,user:c,email:n,firebase:d.firebase}}]);
